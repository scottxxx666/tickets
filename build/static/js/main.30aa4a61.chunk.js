(this.webpackJsonptickets=this.webpackJsonptickets||[]).push([[0],{384:function(e,t,n){e.exports=n(453)},453:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(19),o=n.n(c),i=n(44),l=n(91),u=n(77),m=n(356),s=n(357),d=n(376),f=n(373),p=n(259),b=n.n(p),E=n(364),v=n.n(E),I=n(362),g=n.n(I),O=n(363),h=n.n(O),j=n(361),k=n.n(j),$=n(366),y=n.n($),C=n(365),T=n.n(C),S=r.a.memo((function(e){var t=e.data;return r.a.createElement("p",{style:{whiteSpace:"break-spaces"}},t)})),A=a.createContext(void 0),w=n(478),N=n(491),x=n(479),D=n(490),P=n(480),F=n(336),G=function(e){var t=e.open,n=e.handleClose,a=e.desc,c=e.handleConfirm;return r.a.createElement(w.a,{open:t,onClose:n},r.a.createElement(N.a,{id:"alert-dialog-title"},"\u6ce8\u610f"),r.a.createElement(x.a,null,r.a.createElement(D.a,{id:"alert-dialog-description"},a)),r.a.createElement(P.a,null,r.a.createElement(F.a,{onClick:n,color:"primary"},"\u53d6\u6d88"),r.a.createElement(F.a,{onClick:c,color:"primary",autoFocus:!0},"\u78ba\u5b9a")))},L=function(e){return Object.keys(e).filter((function(e){return!e.startsWith("_")})).reduce((function(t,n){return t[n]=e[n],t}),{})},_=function(e){Object(d.a)(n,e);var t=Object(f.a)(n);function n(){var e;Object(m.a)(this,n);for(var c=arguments.length,o=new Array(c),i=0;i<c;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o)))._tableIcons={Filter:Object(a.forwardRef)((function(e,t){return r.a.createElement(k.a,Object.assign({},e,{ref:t}))})),ResetSearch:Object(a.forwardRef)((function(e,t){return r.a.createElement(g.a,Object.assign({},e,{ref:t}))})),Search:Object(a.forwardRef)((function(e,t){return r.a.createElement(h.a,Object.assign({},e,{ref:t}))})),SortArrow:Object(a.forwardRef)((function(e,t){return r.a.createElement(v.a,Object.assign({},e,{ref:t}))}))},e._titles=[{title:"\u66f4\u65b0\u6642\u9593",field:"updatedAt",defaultSort:"desc",render:function(e){return new Date(parseInt(e.updatedAt)).toLocaleString()}},{title:"\u72c0\u614b",field:"status",lookup:{WAITING:"\u8b93\u7968\u4e2d",DONE:"\u5df2\u7d50\u675f"},defaultFilter:["WAITING"]},{title:"\u5340\u57df",field:"area"},{title:"\u4f4d\u5b50",field:"seat"},{title:"\u5f35\u6578",field:"number"},{title:"\u7968\u50f9",field:"price"},{title:"\u4ea4\u6613\u65b9\u5f0f",field:"payment",render:function(e){var t=e.payment;return r.a.createElement(S,{data:t})}},{title:"\u5099\u8a3b",field:"note",render:function(e){var t=e.note;return r.a.createElement(S,{data:t})}},{title:"\u806f\u7d61\u65b9\u5f0f",field:"contactInformation",render:function(e){return e.contactInformation.map((function(e){return r.a.createElement("div",{key:e.platform},e.platform," \u5e33\u865f\uff1a",e.platformId)}))}}],e.state={open:!1,ticket:null},e.getActions=function(t){return t.isLogin()?[function(n){return{icon:function(){return r.a.createElement(T.a,null)},tooltip:"\u5df2\u7d50\u675f",onClick:function(){e.setState({open:!0,ticket:n})},hidden:!e.canDoRowAction(t,n)||"DONE"===n.status}},function(n){return{icon:function(){return r.a.createElement(y.a,null)},tooltip:"\u7de8\u8f2f",onClick:function(t,n){return e.props.history.push("tickets/"+n.id)},hidden:!e.canDoRowAction(t,n)}}]:[]},e.endTicket=function(){e.props.updateTicket({variables:Object(u.a)(Object(u.a)({},e.state.ticket),{},{eventId:e.state.ticket.event.id,status:"DONE",contactInformation:e.state.ticket.contactInformation.map(L)})}),e.closeConfirm()},e.closeConfirm=function(){e.setState({open:!1})},e}return Object(s.a)(n,[{key:"canDoRowAction",value:function(e,t){return e.getUser().id===t.postedBy.id}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(b.a,{icons:this._tableIcons,columns:this._titles,data:this.props.tickets,options:{filtering:!0,toolbar:!1,paging:!1},localization:{header:{actions:"\u4fee\u6539"},body:{emptyDataSourceMessage:"\u9084\u6c92\u6709\u8cc7\u6599\u8036"}},actions:this.getActions(this.context)}),r.a.createElement(G,{open:this.state.open,handleClose:this.closeConfirm,desc:"\u78ba\u5b9a\u8981\u5c07\u552e\u7968\u72c0\u614b\u6539\u70ba\u201c\u5df2\u7d50\u675f\u201d\u55ce\uff1f",handleConfirm:this.endTicket}))}}]),n}(r.a.Component);_.contextType=A;var B=n(489),V=n(483),R=n(335),W=n(369),q=n.n(W),U=n(31),z=n(86),J=n(76),H=n(90);function K(){var e=Object(l.a)(["\n    mutation UpdateTicket(\n        $id:ID!\n        $area: String!\n        $seat: String!\n        $number: Int!\n        $price: Int!\n        $payment: String!\n        $note: String\n        $contactInformation: [ContactInformationInput!]\n        $eventId: ID!\n    ) {\n        updateTicket(\n            id: $id\n            input: {\n                status: DONE\n                area: $area\n                seat: $seat\n                number: $number\n                price: $price\n                payment: $payment\n                note: $note\n                contactInformation: $contactInformation\n                event: {\n                    id: $eventId\n                }\n            }) {\n            id\n        }\n    }\n"]);return K=function(){return e},e}function M(){var e=Object(l.a)(["\n    query GetTickets($eventId: ID!) {\n        tickets(eventId: $eventId) {\n            id\n            status\n            area\n            seat\n            number\n            price\n            payment\n            note\n            contactInformation {\n                platform\n                platformId\n            }\n            postedBy {\n                id\n            }\n            event {\n                id\n            }\n            updatedAt\n        }\n    }\n"]);return M=function(){return e},e}var Q=Object(R.a)((function(e){return{header:{padding:e.spacing(4)},icon:{padding:e.spacing(.3)}}})),X=(Object(J.b)(M()),Object(J.b)(K())),Y=function(){var e=Q(),t=Object(U.j)(),n=(Object(U.i)().eventId,Object(H.a)(X,{onCompleted:function(e){},onError:function(e){console.error(e)}})),a=Object(i.a)(n,1)[0],c=Object(U.g)(),o=({tickets:[{note:"\u6587\u6e56\u7dda",payment:"\u9762\u4ea4",price:3500,number:1,seat:"35 \u6392 12 \u865f",status:"WAITING",area:"1A",contactInformation:[{platform:"PTT",platformId:"aaaaaa"}],updatedAt:"1625985366000"},{note:"",payment:"\u532f\u6b3e",price:5200,number:2,seat:"1 \u6392 22, 23 \u865f",status:"WAITING",area:"1A",contactInformation:[{platform:"PTT",platformId:"bbb"}],updatedAt:"1625984336000"},{note:"",payment:"\u9762\u4ea4",price:3500,number:4,seat:"40 \u6392 12 \u865f",status:"WAITING",area:"3A",contactInformation:[{platform:"FACEBOOK",platformId:"cccc"}],updatedAt:"1625885366000"}]}||[]).tickets;return r.a.createElement(B.a,null,r.a.createElement(V.a,{className:e.header,container:!0,direction:"row",justify:"flex-end"},r.a.createElement(V.a,{item:!0,xs:1},r.a.createElement(z.b,{to:"".concat(t.url,"/create")},r.a.createElement(F.a,{variant:"contained",color:"primary"},r.a.createElement(q.a,{className:e.icon})," \u65b0\u589e")))),r.a.createElement(_,{tickets:o,updateTicket:a,history:c}))},Z=n(374),ee=n(205),te=n(485),ne=n(487),ae=n(95),re=n(486),ce=n(332),oe=function(e){return a.createElement(V.a,{item:!0,xs:12},a.createElement(ce.a,Object.assign({margin:"normal"},e)))},ie=n(135),le=n.n(ie),ue=function(e){var t=e.open,n=e.handleClose,a=e.title,c=void 0===a?"\u932f\u8aa4":a,o=e.desc;return r.a.createElement(w.a,{open:t,onClose:n},r.a.createElement(N.a,{id:"alert-dialog-title"},c),r.a.createElement(x.a,null,r.a.createElement(D.a,{id:"alert-dialog-description"},o)),r.a.createElement(P.a,null,r.a.createElement(F.a,{onClick:n,color:"primary",autoFocus:!0},"\u78ba\u5b9a")))},me=function(e,t){var n=e.find((function(e){return e.platform===t}));return n?n.platformId:null},se=function(e){var t=e.handleChange,n=e.handleContactChange,r=e.submit,c=e.error,o=e.ticket,l=e.title,u=le()((function(e){return{form:{minWidth:700,padding:e.spacing(5)}}}))(),m=Object(a.useState)(!1),s=Object(i.a)(m,2),d=s[0],f=s[1];return Object(a.useEffect)((function(){c&&f(!0)}),[c]),a.createElement(V.a,{container:!0,justify:"center"},a.createElement(ue,{open:d,handleClose:function(){return f(!1)},desc:"\u62b1\u6b49\uff0c\u7db2\u8def\u932f\u8aa4\uff0c\u9ebb\u7169\u7a0d\u5f8c\u518d\u8a66\u3002",handleConfirm:function(){return f(!1)}}),a.createElement(te.a,null,a.createElement("form",{className:u.form},a.createElement(ne.a,null,a.createElement(V.a,{container:!0,justify:"center"},a.createElement(ae.a,{variant:"h5",component:"h2"},l)),a.createElement(oe,{id:"area",name:"area",label:"\u7968\u5377\u5340\u57df",placeholder:"\u7d052A\u5340",onChange:t,defaultValue:o.area,required:!0}),a.createElement(oe,{id:"seat",name:"seat",label:"\u5ea7\u4f4d\u5e8f\u865f",placeholder:"10\u639212\u865f",onChange:t,defaultValue:o.seat,required:!0}),a.createElement(oe,{id:"number",name:"number",label:"\u5f35\u6578",type:"number",inputProps:{min:1},onChange:t,defaultValue:o.number||1,required:!0}),a.createElement(oe,{id:"price",name:"price",label:"\u9810\u552e\u50f9\u683c",type:"number",helperText:"\u6ce8\u610f\uff1a\u552e\u50f9\u4e0d\u5f97\u6bd4\u539f\u7968\u50f9\u9ad8\uff01",inputProps:{min:0},onChange:t,defaultValue:o.price}),a.createElement(oe,{id:"payment",name:"payment",label:"\u4ea4\u6613\u65b9\u5f0f",multiline:!0,onChange:t,defaultValue:o.payment}),a.createElement(oe,{id:"note",name:"note",label:"\u5099\u8a3b",multiline:!0,onChange:t,defaultValue:o.note}),a.createElement(oe,{id:"ptt_id",name:"ptt_id",label:"PTT ID",inputProps:{"data-platform":"PTT"},onChange:n,defaultValue:me(o.contactInformation,"PTT")}),a.createElement(oe,{id:"line_id",name:"line_id","data-platform":"LINE",label:"LINE ID",inputProps:{"data-platform":"LINE"},onChange:n,defaultValue:me(o.contactInformation,"LINE")}),a.createElement(oe,{id:"fb_id",name:"fb_id",label:"FB \u7528\u6236\u540d\u7a31","data-platform":"FB",helperText:"\u975e\u4e2d\u6587\uff01\u53ef\u4ee5\u770b\u500b\u4eba\u9801\u9762\u7684\u7db2\u5740 facebook.com/ \u4e4b\u5f8c\u7684\u90e8\u5206\uff0c\u6216\u662f\u53c3\u8003 https://www.facebook.com/help/messenger-app/android/1047811435279151",inputProps:{"data-platform":"FB"},onChange:n,defaultValue:me(o.contactInformation,"FB")})),a.createElement(re.a,null,a.createElement(F.a,{variant:"contained",color:"primary",onClick:r},"\u63d0\u4ea4")))))},de=function(e){var t=e.default,n=Object(a.useState)(t||{area:null,seat:null,number:1,price:null,payment:null,note:"",event:{id:e.eventId}}),c=Object(i.a)(n,2),o=c[0],l=c[1],m=Object(a.useState)(t?t.contactInformation:[{platform:"PTT",platformId:""},{platform:"LINE",platformId:""}]),s=Object(i.a)(m,2),d=s[0],f=s[1];return r.a.createElement(se,Object(u.a)(Object(u.a)({},e),{},{handleChange:function(e){var t=e.target.name,n=e.target.value;l((function(e){return Object(u.a)(Object(u.a)({},e),{},Object(ee.a)({},t,n))}))},handleContactChange:function(e){var t=e.target.dataset.platform,n=e.target.value;f((function(e){return[].concat(Object(Z.a)(e.filter((function(e){return e.platform!==t}))),[{platform:t,platformId:n}])}))},ticket:Object(u.a)(Object(u.a)({},o),{},{contactInformation:d}),submit:function(){e.saveTicket({variables:Object(u.a)(Object(u.a)({},o),{},{contactInformation:d.map(L),number:parseInt(o.number,10),price:parseInt(o.price,10),eventId:o.event.id})})}}))};function fe(){var e=Object(l.a)(["\n    mutation CreateTicket(\n        $area: String!\n        $seat: String!\n        $number: Int!\n        $price: Int!\n        $payment: String!\n        $note: String\n        $contactInformation: [ContactInformationInput!]\n        $eventId: ID!\n    ) {\n        createTicket(input: {\n            status: WAITING\n            area: $area\n            seat: $seat\n            number: $number\n            price: $price\n            payment: $payment\n            note: $note\n            contactInformation: $contactInformation\n            event: {\n                id: $eventId\n            }\n        }) {\n            id\n        }\n    }\n"]);return fe=function(){return e},e}var pe=Object(J.b)(fe()),be=function(){var e=Object(U.i)().eventId,t=Object(U.g)(),n=Object(H.a)(pe,{onCompleted:function(n){t.push("/event/".concat(e,"/tickets"))},onError:function(e){console.error(e)}}),r=Object(i.a)(n,2),c=r[0],o=r[1].error;return a.createElement(de,{error:o,title:"\u65b0\u589e\u4e00\u7b46\u552e\u7968\u8cc7\u6599",eventId:e,saveTicket:c})},Ee=n(370),ve=n.n(Ee);function Ie(){var e=Object(l.a)(['\n    mutation($token:String!){\n        login(platform:"GOOGLE", token:$token){\n            token\n            user{\n                id\n                email\n                name\n            }\n        }\n    }\n']);return Ie=function(){return e},e}var ge=Object(R.a)((function(e){return{title:{padding:e.spacing(3)}}})),Oe=Object(J.b)(Ie()),he=function(){var e=Object(U.h)(),t=Object(U.g)(),n=Object(a.useContext)(A),c=Object(H.a)(Oe,{onCompleted:function(a){n.update(a.login),function(){var n=(e.state||{from:{pathname:"/"}}).from;t.replace(n)}()}}),o=Object(i.a)(c,1)[0],l=ge();return r.a.createElement(V.a,{container:!0,direction:"column",alignItems:"center"},r.a.createElement(ae.a,{className:l.title,variant:"h4"}),r.a.createElement(ve.a,{onSuccess:function(e){return o({variables:{token:e.tokenId}})},onFailure:function(e){console.error(e)},clientId:"65212064773-ilpobktmefb3kj2d9mv589er1d9n3i9v.apps.googleusercontent.com"}))},je=n(371),ke=n.n(je),$e=n(231),ye=n.n($e);var Ce=function(e){var t=Object(a.useState)(function(){var e=ye.a.get("auth");return e?JSON.parse(e):void 0}()),n=Object(i.a)(t,2),c=n[0],o=n[1];return r.a.createElement(A.Provider,Object.assign({value:{data:c,update:function(e){ye.a.set("auth",e,{sameSite:"lax",expires:30}),o(e)},logout:function(){ye.a.remove("auth"),o(void 0)},isLogin:function(){return c},getUser:function(){return c?c.user:null},getToken:function(){return c?c.token:null}}},e))},Te=n(484),Se=n(322),Ae=n(494),we=n(492),Ne=n(225),xe=n.n(Ne),De=n(463),Pe=n(379),Fe=n(136),Ge=n(488),Le=n(461),_e=n(321),Be=function(){var e=Object(a.useState)(!1),t=Object(i.a)(e,2),n=t[0],c=t[1],o=r.a.useRef(null),l=function(){c(!1)},u=function(){m.logout()},m=Object(a.useContext)(A);return r.a.createElement(r.a.Fragment,null,r.a.createElement(F.a,{edge:"end",variant:"contained",color:"default",endIcon:r.a.createElement(xe.a,null),onClick:function(){c((function(e){return!e}))},ref:o},m.getUser().name),r.a.createElement(De.a,{open:n,anchorEl:o.current,transition:!0,disablePortal:!0},(function(e){var t=e.TransitionProps,n=e.placement;return r.a.createElement(Pe.a,Object.assign({},t,{style:{transformOrigin:"bottom"===n?"center top":"center bottom"}}),r.a.createElement(Fe.a,null,r.a.createElement(Ge.a,{onClickAway:l},r.a.createElement(Le.a,null,r.a.createElement(_e.a,{onClick:u},"\u767b\u51fa")))))})))},Ve=n(260),Re=function(e){return r.a.createElement(z.b,Object.assign({to:function(e){return{pathname:"/login",state:{from:e}}}},e))},We=function(){return r.a.createElement(Re,null,r.a.createElement(Ve.a,null,r.a.createElement(xe.a,{fontSize:"large"})))},qe=le()((function(e){return{grow:{flexGrow:1}}}));function Ue(e){var t=e.children,n=Object(Ae.a)();return r.a.createElement(we.a,{appear:!1,direction:"down",in:!n},t)}var ze=function(){var e=qe(),t=Object(a.useContext)(A);return r.a.createElement(a.Fragment,null,r.a.createElement(Ue,null,r.a.createElement(Te.a,{position:"fixed"},r.a.createElement(Se.a,null,r.a.createElement("div",{className:e.grow}),t.isLogin()?r.a.createElement(Be,null):r.a.createElement(We,null)))),r.a.createElement(Se.a,{id:"back-to-top-anchor"}))},Je=n(493),He=n(372),Ke=n.n(He),Me=n(495);function Qe(){document.querySelector("#back-to-top-anchor").scrollIntoView({behavior:"smooth"})}var Xe=le()((function(e){return{root:{position:"fixed",bottom:e.spacing(3),right:e.spacing(4)}}})),Ye=function(){var e=Object(Ae.a)({disableHysteresis:!0}),t=Xe();return r.a.createElement(Me.a,{in:e},r.a.createElement("div",{onClick:Qe,role:"presentation",className:t.root},r.a.createElement(Je.a,{color:"secondary",size:"small","aria-label":"scroll back to top"},r.a.createElement(Ke.a,null))))},Ze=n(375),et=function(e){var t=Object(a.useContext)(A),n=e.children,c=Object(Ze.a)(e,["children"]);return r.a.createElement(U.b,Object.assign({},c,{render:function(e){return t.isLogin()?n:r.a.createElement(U.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},tt=n(58),nt=function(e){var t=Object(a.useContext)(A),n=new J.a({uri:"http://localhost:4000/",headers:{Authorization:t.isLogin()?"Bearer ".concat(t.getToken()):""}});return r.a.createElement(tt.a,Object.assign({client:n},e))};function at(){var e=Object(l.a)(["\n    mutation UpdateTicket(\n        $id: ID!\n        $area: String!\n        $seat: String!\n        $number: Int!\n        $price: Int!\n        $payment: String!\n        $note: String\n        $contactInformation: [ContactInformationInput!]\n        $eventId: ID!\n    ) {\n        updateTicket(\n            id: $id\n            input: {\n                status: WAITING\n                area: $area\n                seat: $seat\n                number: $number\n                price: $price\n                payment: $payment\n                note: $note\n                contactInformation: $contactInformation\n                event: {\n                    id: $eventId\n                }\n            }) {\n            id\n        }\n    }\n"]);return at=function(){return e},e}function rt(){var e=Object(l.a)(["\n    query GetTicket($id: ID!) {\n        ticket(id: $id) {\n            id\n            status\n            area\n            seat\n            number\n            price\n            payment\n            note\n            contactInformation {\n                platform\n                platformId\n            }\n            postedBy {\n                id\n            }\n            event {\n                id\n            }\n            updatedAt\n        }\n    }\n"]);return rt=function(){return e},e}var ct=Object(J.b)(rt()),ot=Object(J.b)(at()),it=function(){var e=Object(U.g)(),t=Object(U.i)(),n=t.ticketId,a=t.eventId,c=Object(H.b)(ct,{variables:{id:n},fetchPolicy:"no-cache"}),o=c.loading,l=c.data,u=Object(H.a)(ot,{onCompleted:function(t){e.push("/event/".concat(a,"/tickets"))},onError:function(e){console.error(e)}}),m=Object(i.a)(u,2),s=m[0],d=m[1].error;if(o)return r.a.createElement("div",null,"loading...");var f=l.ticket;return r.a.createElement(de,{error:d,eventId:f.eventId,saveTicket:s,default:f,title:"\u66f4\u65b0\u552e\u7968\u8cc7\u6599"})},lt=function(){return ke.a.config(),r.a.createElement(Ce,null,r.a.createElement(nt,null,r.a.createElement(z.a,null,r.a.createElement("div",{className:"App"},r.a.createElement(ze,null),r.a.createElement(U.d,null,r.a.createElement(U.b,{path:"/about"},"Hi"),r.a.createElement(U.b,{path:"/login"},r.a.createElement(he,null)),r.a.createElement(et,{path:"/event/:eventId/tickets/create"},r.a.createElement(be,null)),r.a.createElement(et,{path:"/event/:eventId/tickets/:ticketId"},r.a.createElement(it,null)),r.a.createElement(U.b,{path:"/event/:eventId/tickets"},r.a.createElement(Y,null)),r.a.createElement(U.b,{path:"/"},"index"))),r.a.createElement(Ye,null))))};o.a.render(r.a.createElement(lt,null),document.getElementById("root"))}},[[384,1,2]]]);
//# sourceMappingURL=main.30aa4a61.chunk.js.map